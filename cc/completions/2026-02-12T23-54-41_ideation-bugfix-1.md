---
task: "Fix ODRC ingestion bugs: RESOLVE parser, false positive detection, OPEN picker, phase awareness"
status: complete
cc-spec-id: sp_ideation_bugfix_1
files:
  - path: "cc/index.html"
    action: modified
commits:
  - sha: "27d2b2d"
    message: "Fix ODRC ingestion bugs + pipeline gaps (v8.61.1)"
odrc:
  resolved_opens: []
  new_opens:
    - "Should flex RESOLVE items without a matching OPEN auto-create a 'resolved' OPEN for audit trail?"
unexpected_findings:
  - "Firebase Config Sync 'Error' status was caused by a race condition — transient push failures after successful pullAll() permanently poisoned the status. Added self-healing recovery timer."
unresolved: []
---

## Approach

All 5 items from sp_ideation_bugfix_1 were implemented in a single pass against index.html (v8.61.0 → v8.61.1):

1. **Bug 1 (RESOLVE parser):** Added two new regex patterns after the existing strict pattern — numbered format (`RESOLVE OPEN {N}: "desc" → text`) and freeform (`RESOLVE OPEN: "desc" → text`). Both set `conceptId: null` and store the resolution text in a new `resolution` field. Updated `execute()` to handle `overrideConceptId` from the checklist dropdown, plus a skip path when no OPEN is selected.

2. **Bug 2 (False positive detection):** Rewrote `detectODRCContent()` to (a) short-circuit on `## ODRC Updates` header, (b) build code-block ranges from triple-backtick fences, (c) count ODRC action line matches only outside code blocks, and (d) require >= 3 real matches instead of 2.

3. **Bug 3 (OPEN picker):** Enhanced the duplicate detection useEffect to also fuzzy-match flex RESOLVE items against active OPENs on the linked idea. Added a purple-themed dropdown UI in the checklist showing all active OPENs with the best fuzzy match pre-selected. Displays resolution text and warns when no OPEN is selected.

4. **Gap 1 (Phase warning):** Added `exploringIdeas` filter to GenerateCLAUDEModal that checks active ideas' phases via `computeIdeaPhase()`. Shows an amber warning banner when exploring ideas exist, recommending "Explore in Chat" first. Non-blocking — doesn't prevent generation.

5. **Gap 2 (Phase-aware brief):** Replaced static `SYSTEM_PROMPT` with `getSystemPrompt(phase)` method. Spec-ready phase gets specification-focused framing ("produce a formal specification"). Updated `generate()` to compute phase and pass it. Updated `buildTemplateBrief()` to shift the header and goal section for spec-ready sessions.

**Bonus fix:** Added Firebase ConfigSync self-healing — when status goes to 'error', a 5-second recovery timer checks connectivity and clears the error if the connection is fine. Also made the optional startup push-back not poison status.

## Implementation Notes

- Version bumped 8.61.0 → 8.61.1
- 177 lines added, 28 removed
- All 34 Playwright tests pass
- The flex RESOLVE patterns must be checked AFTER the strict concept_id pattern to avoid the more general regex consuming strict matches
- Code-block detection in `detectODRCContent()` uses triple-backtick ranges — doesn't handle indented code blocks (4-space) but those are rare in ODRC files
- The OPEN picker pre-selects based on `findDuplicateConcepts()` word overlap — same heuristic used for duplicate detection on NEW items
