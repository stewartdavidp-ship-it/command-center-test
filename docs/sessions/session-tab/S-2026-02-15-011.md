# ODRC Updates — Session Tab
# Date: 2026-02-15
# Session: S-2026-02-15-011 (Unit 5 spec production — ingestion pipeline spec + CLAUDE.md)
# Idea: session-tab
# IdeaId: -OlO6yEDlG9FFkjXgAxl
# App: command-center
# Context: Produced Unit 5 spec and CLAUDE.md for the ingestion pipeline covering package detection, session.json validation, tangent routing, debrief storage, phase ratchet prompt, and context package button.

- NEW DECISION: "Session package zips are detected at the package level via isSessionPackageZip() before deploy routing. A zip containing session.json is always treated as a session package — deploy packages should never contain a file named session.json. This prevents session packages from being misrouted through the deploy pipeline."
- NEW DECISION: "Tangent ODRC items with resolvable affinity slugs are routed to their target ideas during executeODRCImport(). Unresolvable slugs fall back to the primary idea with a console warning. Tangent routing is best-effort and never blocks the import."
- NEW DECISION: "Debriefs are stored in Firebase at command-center/{uid}/ideas/{ideaId}/debriefs/{sessionId} with summary, full content, and nextSession fields. Debrief storage is fire-and-forget — failure does not block the primary import."
- NEW DECISION: "Phase ratchet prompt appears on the post-import results screen only when computeIdeaPhase() returns a phase higher than the stored phase in PHASE_ORDER. Developer clicks to advance or dismiss. advancePhase() is never called automatically — the ratchet is advisory."
- NEW DECISION: "Context package (Download Context Package button in ExploreInChatModal) includes: codebase files from GitHub repo (index.html, sw.js, manifest.json, CLAUDE.md), existing spec docs fetched via docPath from session log entries with type:'spec', ODRC state snapshot as JSON, and session history summary as JSON."
- RESOLVE OPEN: "Should spec context package include existing spec docs from prior units?" → Yes. Context package fetches spec documents from session log entries with type:'spec' and docPath values. All prior specs for the idea are included automatically.
- RESOLVE OPEN: "For claude-md sessions, how does CC know which spec to include — idea record tracks artifact path, or developer selects?" → Artifact path from session log. All specs for the idea are included via docPath lookup from session log entries. No manual selection needed.

## Session Notes

### What Was Accomplished
Produced the complete Unit 5 specification and CLAUDE.md for the ingestion pipeline. Reviewed the v8.68.0 codebase in detail, confirming that SessionPackageProcessor, detectInboundArtifactType, executeODRCImport, and ODRCImportChecklistModal already provide ~70% of the needed infrastructure. The spec identifies six gaps: package-level zip detection, tangent item routing, debrief extraction/storage, phase ratchet prompt, context package button, and import checklist enhancements for session package metadata. The CLAUDE.md organizes the build into four phases (A: detection/processing, B: checklist enhancements, C: post-import lifecycle, D: context package) with 14 numbered tasks and line references to the current codebase.

### Key Design Principles Established
- Package-level detection prevents session packages from entering the deploy pipeline — check for session.json existence before checking isMultiAppZip
- Tangent routing is best-effort with silent fallback — never blocks imports, degrades gracefully to primary idea
- Phase ratchet is strictly one-directional and developer-controlled — system suggests, human decides
- Context package is always available regardless of session type — no conditional logic, developer clicks when needed
- Debrief storage is fire-and-forget — import success is never gated on debrief persistence

### Artifacts Produced
| # | Filename | Type | Status | Purpose |
|---|----------|------|--------|---------|
| 1 | spec-unit-5-ingestion-pipeline.md | spec | complete | Unit 5 spec document |
| 2 | CLAUDE-ingestion-pipeline.md | claude-md | complete | Build instructions for Code |
| 3 | restart-doc-session-tab-S011-link3.md | restart-doc | complete | Chain continuation doc |
| 4 | link-brief-S011-link2.md | link-brief | complete | Link 2 summary for summation |
| 5 | ODRC-Updates-session-tab-S011.md | odrc | complete | This document |

### Session Status
- Concepts: 5 DECISIONs (new), 2 OPENs resolved, 0 RULEs, 0 CONSTRAINTs
- Phase: spec-ready (unchanged)
- Next session: Build Unit 4 (landing page UX) first, then Unit 5 (ingestion pipeline). Unit 5 depends on Unit 4 for the session card context in which ingestion results display.
